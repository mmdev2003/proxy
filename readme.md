# ๐ ะะฒััััะพะฒะฝะตะฒะฐั ะฟัะพะบัะธ-ัะธััะตะผะฐ ั ัะธััะพะฒะฐะฝะธะตะผ

> ะะตะทะพะฟะฐัะฝะฐั ะธ ะผะฐัััะฐะฑะธััะตะผะฐั ัะธััะตะผะฐ ะฟัะพะบัะธัะพะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ ัะตัะตะท ัะฐัะฟัะตะดะตะปะตะฝะฝัะต ะฑัะบะตะฝะดั ั end-to-end ัะธััะพะฒะฐะฝะธะตะผ

---

## ๐ ะะฑะทะพั ะฟัะพะตะบัะฐ

**ะะฒััััะพะฒะฝะตะฒะฐั ะฟัะพะบัะธ-ัะธััะตะผะฐ** โ ััะพ ะฐััะธัะตะบัััะฝะพะต ัะตัะตะฝะธะต ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั HTTP-ะทะฐะฟัะพัะพะฒ ัะตัะตะท ะฟัะพะผะตะถััะพัะฝัะต ัะตัะฒะตัั ั ะฟะพะปะฝัะผ ัะธััะพะฒะฐะฝะธะตะผ ะดะฐะฝะฝัั ะผะตะถะดั ัะทะปะฐะผะธ.

### ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ   ะะปะธะตะฝั    โโโโโถโ ะะตัะฒัะน       โโโโโถโ ะัะพัะพะน      โโโโโถโ  ะฆะตะปะตะฒะพะน     โ
โ             โ    โ ะฑัะบะตะฝะด       โ    โ ะฑัะบะตะฝะด      โ    โ  ัะตัะฒะตั      โ
โ             โโโโโโ (ะะฐัััััะธะทะฐัะพั)โโโโโโ (ะัะพะบัะธ)    โโโโโโ             โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
                           โ                     
                           โผ                     
                   โโโโโโโโโโโโโโโโ             
                   โ PostgreSQL   โ             
                   โ (ะะฐะฟะฟะธะฝะณ     โ             
                   โ  ะดะพะผะตะฝะพะฒ)    โ             
                   โโโโโโโโโโโโโโโโ             
```

---

## ๐ฏ ะะฐะทะฝะฐัะตะฝะธะต ัะธััะตะผั

### **ะัะฝะพะฒะฝัะต ัะตะปะธ:**

- **๐ก๏ธ ะะตะทะพะฟะฐัะฝะพััั** โ ะกะบัััะธะต ัะตะฐะปัะฝัั ะดะพะผะตะฝะพะฒ ะธ ัะธััะพะฒะฐะฝะธะต ััะฐัะธะบะฐ
- **๐ ะะฝะพะฝะธะผะฝะพััั** โ ะัะพะบัะธัะพะฒะฐะฝะธะต ะทะฐะฟัะพัะพะฒ ัะตัะตะท ะฟัะพะผะตะถััะพัะฝัะต ัะตัะฒะตัั  
- **โก ะะฐัััะฐะฑะธััะตะผะพััั** โ ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฝะฐะณััะทะบะธ ะผะตะถะดั ะฝะตะทะฐะฒะธัะธะผัะผะธ ัะทะปะฐะผะธ
- **๐ง ะะธะฑะบะพััั** โ ะะธะฝะฐะผะธัะตัะบะพะต ัะฟัะฐะฒะปะตะฝะธะต ะดะพะผะตะฝะฐะผะธ ัะตัะตะท API

### **ะัะธะผะตะฝะตะฝะธะต:**
- ะะฑัะพะด ะณะตะพะณัะฐัะธัะตัะบะธั ะฑะปะพะบะธัะพะฒะพะบ
- ะะฐัะธัะฐ ะพั DDoS-ะฐัะฐะบ ัะตัะตะท ัะฐัะฟัะตะดะตะปะตะฝะธะต
- ะะพะฝะธัะพัะธะฝะณ ะธ ะฐะฝะฐะปะธัะธะบะฐ ััะฐัะธะบะฐ
- ะะตัะธัะพะฒะฐะฝะธะต ะธ ะพะฟัะธะผะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ

---

## ๐ ะัััััะน ััะฐัั

### 1๏ธโฃ ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

```bash
# ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั
git clone <repository-url>
cd proxy-system

# ะกะพะทะดะฐะฝะธะต .env ัะฐะนะปะฐ
cp .env.example .env
```

### 2๏ธโฃ ะะพะฝัะธะณััะฐัะธั `.env`

```bash
# ๐ ะจะธััะพะฒะฐะฝะธะต (ะะะฏะะะขะะะฌะะ 32 ัะธะผะฒะพะปะฐ!)
CRYPTO_KEY=your_super_secret_32_char_key_here

# ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั PostgreSQL
POSTGRES_USER=proxy_user
POSTGRES_PASSWORD=secure_password_123
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_DB=proxy_domains

# ๐ IP ะฐะดัะตัะฐ ัะตัะฒะตัะพะฒ
FIRST_BACKEND=192.168.1.100:8000
SECOND_BACKEND=192.168.1.200:8100
```

### 3๏ธโฃ ะะฐะฟััะบ ะฟะตัะฒะพะณะพ ะฑัะบะตะฝะดะฐ

```bash
cd first_backend
docker-compose up --build -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
curl http://localhost:8000/api/ping
# ะัะฒะตั: "pong"
```

### 4๏ธโฃ ะะฐะฟััะบ ะฒัะพัะพะณะพ ะฑัะบะตะฝะดะฐ

```bash
cd second_backend
docker-compose up --build -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ  
curl http://localhost:8100/api/ping
# ะัะฒะตั: "pong"
```

---

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต ะดะพะผะตะฝะฐะผะธ

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะดะพะผะตะฝะฐ

```bash
curl -X POST "http://your-first-backend/api/add/domain" \
  -H "Content-Type: application/json" \
  -d '{
    "public_domain": "safe-alias",
    "domain": "https://target-website.com"
  }'
```

**ะัะธะผะตั:**
```json
{
  "public_domain": "news-portal",
  "domain": "https://bbc.com"
}
```

### ะัะพะฒะตัะบะฐ ะดะพะผะตะฝะฐ

```bash
curl -X POST "http://your-first-backend/api/check_domain" \
  -H "Content-Type: application/json" \
  -d '{
    "public_domain": "news-portal",
    "path": "/world",
    "request_type": "GET",
    "body": {},
    "headers": {},
    "cookies": {}
  }'
```

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั

### ะะตัะฐะปัะฝะฐั ััะตะผะฐ ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะฐ:

```mermaid
sequenceDiagram
    participant C as ะะปะธะตะฝั
    participant F as ะะตัะฒัะน ะฑัะบะตะฝะด
    participant D as ะะฐะทะฐ ะดะฐะฝะฝัั
    participant S as ะัะพัะพะน ะฑัะบะตะฝะด  
    participant T as ะฆะตะปะตะฒะพะน ัะตัะฒะตั

    C->>F: HTTP ะทะฐะฟัะพั ั public_domain
    F->>D: ะะพะธัะบ ัะตะฐะปัะฝะพะณะพ ะดะพะผะตะฝะฐ
    D-->>F: ะะพะทะฒัะฐั domain
    F->>F: ะจะธััะพะฒะฐะฝะธะต ะดะฐะฝะฝัั
    F->>S: ะัะฟัะฐะฒะบะฐ ะทะฐัะธััะพะฒะฐะฝะฝัั ะดะฐะฝะฝัั
    S->>S: ะะฐััะธััะพะฒะบะฐ ะดะฐะฝะฝัั
    S->>T: ะะฐะฟัะพั ะบ ัะตะปะตะฒะพะผั ัะตัะฒะตัั
    T-->>S: ะัะฒะตั ะพั ัะตะปะตะฒะพะณะพ ัะตัะฒะตัะฐ
    S->>S: ะจะธััะพะฒะฐะฝะธะต ะพัะฒะตัะฐ
    S-->>F: ะะฐัะธััะพะฒะฐะฝะฝัะน ะพัะฒะตั
    F->>F: ะะฐััะธััะพะฒะบะฐ ะพัะฒะตัะฐ
    F-->>C: ะคะธะฝะฐะปัะฝัะน ะพัะฒะตั
```

---

## ๐ API ะะพะบัะผะตะฝัะฐัะธั

### ๐ ะญะฝะดะฟะพะธะฝัั ะฟะตัะฒะพะณะพ ะฑัะบะตะฝะดะฐ

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| `POST` | `/api/add/domain` | ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะดะพะผะตะฝะฐ |
| `POST` | `/api/check_domain` | ะัะพะฒะตัะบะฐ ะธ ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต |
| `GET` | `/api/ping` | ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ |
| `GET` | `/api/docs` | Swagger ะดะพะบัะผะตะฝัะฐัะธั |

### ๐ ะญะฝะดะฟะพะธะฝัั ะฒัะพัะพะณะพ ะฑัะบะตะฝะดะฐ

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| `POST` | `/api/capture` | ะัะธะตะผ ะทะฐัะธััะพะฒะฐะฝะฝัั ะดะฐะฝะฝัั |
| `POST` | `/api/redirect/get` | ะัะฟะพะปะฝะตะฝะธะต GET ะทะฐะฟัะพัะพะฒ |
| `GET` | `/api/ping` | ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ |

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะธะต ัะตััั

```bash
# ะะตัะตัะพะด ะฒ ะฟะฐะฟะบั ัะตััะพะฒ
cd tests

# ะะฐะฟััะบ ัะตััะพะฒะพะณะพ ะฝะฐะฑะพัะฐ
python test.py
```

### ะััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

```bash
# 1. ะะพะฑะฐะฒะปะตะฝะธะต ัะตััะพะฒะพะณะพ ะดะพะผะตะฝะฐ
curl -X POST "http://localhost:8000/api/add/domain" \
  -H "Content-Type: application/json" \
  -d '{"public_domain": "test-site", "domain": "https://httpbin.org"}'

# 2. ะขะตััะพะฒัะน ะทะฐะฟัะพั ัะตัะตะท ะฟัะพะบัะธ
curl -X POST "http://localhost:8000/api/check_domain" \
  -H "Content-Type: application/json" \
  -d '{
    "public_domain": "test-site",
    "path": "/get",
    "request_type": "GET",
    "body": {},
    "headers": {},
    "cookies": {}
  }'
```

---

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

### **Backend Framework**
- **FastAPI** โ ะกะพะฒัะตะผะตะฝะฝัะน ะฒะตะฑ-ััะตะนะผะฒะพัะบ ะดะปั Python
- **Uvicorn** โ ASGI ัะตัะฒะตั ะดะปั ะทะฐะฟััะบะฐ ะฟัะธะปะพะถะตะฝะธะน

### **ะะฐะทะฐ ะดะฐะฝะฝัั** 
- **PostgreSQL 15** โ ะะตะปััะธะพะฝะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **SQLAlchemy** โ ORM ะดะปั ัะฐะฑะพัั ั ะะ
- **AsyncPG** โ ะัะธะฝััะพะฝะฝัะน ะดัะฐะนะฒะตั PostgreSQL

### **ะะฝััะฐััััะบัััะฐ**
- **Docker & Docker Compose** โ ะะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **Caddy** โ ะะตะฑ-ัะตัะฒะตั ะธ ะพะฑัะฐัะฝัะน ะฟัะพะบัะธ

### **ะะตะทะพะฟะฐัะฝะพััั**
- **Cryptocode** โ ะกะธะผะผะตััะธัะฝะพะต ัะธััะพะฒะฐะฝะธะต
- **Environment Variables** โ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะฝัะธะณััะฐัะธะตะน

### **HTTP ะบะปะธะตะฝัั**
- **aiohttp** โ ะัะธะฝััะพะฝะฝัะต HTTP ะทะฐะฟัะพัั
- **requests** โ ะกะธะฝััะพะฝะฝัะต HTTP ะทะฐะฟัะพัั

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั ะบะพะผะฟะพะฝะตะฝัะพะฒ

### Docker Compose (ะฟะตัะฒัะน ะฑัะบะตะฝะด)

```yaml
version: "3.9"
services:
  first_backend:
    build:
      dockerfile: ./Dockerfile
    container_name: first_backend
    ports:
      - "8000:8000"
    depends_on:
      - db
    
  first_caddy:
    image: caddy:2.7.6
    ports:
      - "80:80"
    volumes:
      - "./docker/caddy:/etc/caddy"
      
  db:
    image: postgres:15.4-alpine
    container_name: db
    restart: unless-stopped
```

### Caddy ะบะพะฝัะธะณััะฐัะธั

```caddyfile
your-server-ip:80 {
    reverse_proxy first_backend:8000
}
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะจะธััะพะฒะฐะฝะธะต ะดะฐะฝะฝัั
- **ะะปะณะพัะธัะผ:** ะกะธะผะผะตััะธัะฝะพะต ัะธััะพะฒะฐะฝะธะต ัะตัะตะท cryptocode
- **ะะปัั:** 32-ัะธะผะฒะพะปัะฝะฐั ัััะพะบะฐ ะฒ ะฟะตัะตะผะตะฝะฝะพะน `CRYPTO_KEY`
- **ะะฑะปะฐััั:** ะัะต ะดะฐะฝะฝัะต ะผะตะถะดั ะฟะตัะฒัะผ ะธ ะฒัะพััะผ ะฑัะบะตะฝะดะพะผ

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะฑะตะทะพะฟะฐัะฝะพััะธ

โ **ะะฑัะทะฐัะตะปัะฝะพ:**
- ะัะฟะพะปัะทัะนัะต ัะปะพะถะฝัะน 32-ัะธะผะฒะพะปัะฝัะน ะบะปัั ัะธััะพะฒะฐะฝะธั
- ะะตะณัะปััะฝะพ ัะพัะธััะนัะต ะบะปััะธ ัะธััะพะฒะฐะฝะธั  
- ะะฐะฟััะบะฐะนัะต ะฑัะบะตะฝะดั ะฝะฐ ัะฐะทะฝัั ัะตัะฒะตัะฐั
- ะัะฟะพะปัะทัะนัะต HTTPS ะดะปั ะฒะฝะตัะฝะธั ะฟะพะดะบะปััะตะฝะธะน

โ๏ธ **ะะทะฑะตะณะฐะนัะต:**
- ะฅัะฐะฝะตะฝะธั ะบะปััะตะน ัะธััะพะฒะฐะฝะธั ะฒ ะบะพะดะต
- ะะฐะฟััะบะฐ ะพะฑะพะธั ะฑัะบะตะฝะดะพะฒ ะฝะฐ ะพะดะฝะพะผ ัะตัะฒะตัะต
- ะัะฟะพะปัะทะพะฒะฐะฝะธั ัะปะฐะฑัั ะฟะฐัะพะปะตะน ะดะปั ะฑะฐะทั ะดะฐะฝะฝัั

---

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ะกัััะบัััะฐ ะปะพะณะพะฒ

```json
{
  "timestamp": "2024-07-07T12:00:00.000Z",
  "level": "INFO", 
  "message": "Domain added successfully",
  "source": "service.py:add_domain:25"
}
```

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ ัะตัะฒะธัะพะฒ

```bash
# ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps

# ะะพะณะธ ะฟะตัะฒะพะณะพ ะฑัะบะตะฝะดะฐ
docker-compose logs first_backend

# ะะพะณะธ ะฒัะพัะพะณะพ ะฑัะบะตะฝะดะฐ  
docker-compose logs second_backend

# ะะพะณะธ ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose logs db
```

---

## ๐จ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะงะฐัััะต ะฟัะพะฑะปะตะผั

**๐ด ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ ะฑะฐะทะต ะดะฐะฝะฝัั**
```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ PostgreSQL
docker-compose exec db psql -U $POSTGRES_USER -d $POSTGRES_DB -c "\l"
```

**๐ด ะัะธะฑะบะธ ัะธััะพะฒะฐะฝะธั**
```bash
# ะัะพะฒะตัะบะฐ ะดะปะธะฝั ะบะปััะฐ (ะดะพะปะถะฝะพ ะฑััั 32)
echo ${#CRYPTO_KEY}
```

**๐ด ะกะตัะตะฒัะต ะพัะธะฑะบะธ ะผะตะถะดั ะฑัะบะตะฝะดะฐะผะธ**
```bash
# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ ะฒัะพัะพะณะพ ะฑัะบะตะฝะดะฐ
curl http://$SECOND_BACKEND/api/ping
```

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะะตัะตะทะฐะฟััะบ ัะธััะตะผั
docker-compose down && docker-compose up --build -d

# ะัะธััะบะฐ ะปะพะณะพะฒ  
docker-compose logs --tail=0 first_backend

# ะะพะดะบะปััะตะฝะธะต ะบ ะบะพะฝัะตะนะฝะตัั
docker-compose exec first_backend sh
```

---

## ๐ ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

### ะะพัะธะทะพะฝัะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

1. **ะะฝะพะถะตััะฒะตะฝะฝัะต ะฟะตัะฒัะต ะฑัะบะตะฝะดั** ะทะฐ load balancer
2. **ะะตัะบะพะปัะบะพ ะฒัะพััั ะฑัะบะตะฝะดะพะฒ** ั round-robin ะฑะฐะปะฐะฝัะธัะพะฒะบะพะน
3. **ะะปะฐััะตั PostgreSQL** ะดะปั ะฒััะพะบะพะน ะดะพัััะฟะฝะพััะธ

### ะะตััะธะบะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

```yaml
# docker-compose.yml
services:
  first_backend:
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
```

---

## ๐ค ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
proxy-system/
โโโ first_backend/
โ   โโโ src/
โ   โ   โโโ api/          # API ัะฝะดะฟะพะธะฝัั
โ   โ   โโโ db/           # ะะพะดะตะปะธ ะฑะฐะทั ะดะฐะฝะฝัั  
โ   โ   โโโ utils/        # ะฃัะธะปะธัั (ัะธััะพะฒะฐะฝะธะต, ะบะปะธะตะฝัั)
โ   โโโ docker/
โ   โโโ requirements.txt
โโโ second_backend/
โ   โโโ src/
โ   โ   โโโ api/          # API ัะฝะดะฟะพะธะฝัั
โ   โ   โโโ utils/        # ะฃัะธะปะธัั
โ   โโโ requirements.txt
โโโ tests/
    โโโ test.py
```

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r first_backend/requirements.txt

# ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
cd first_backend/src
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

---

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ะพะฑัะฐะทะพะฒะฐัะตะปัะฝัั ะธ ะธััะปะตะดะพะฒะฐัะตะปััะบะธั ัะตะปะตะน. ะัะฟะพะปัะทัะนัะต ะพัะฒะตัััะฒะตะฝะฝะพ ะธ ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะผะตััะฝัะผ ะทะฐะบะพะฝะพะดะฐัะตะปัััะฒะพะผ.

---

*ะะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ: July 2025*
